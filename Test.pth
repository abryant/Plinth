package foo.bar;

interface Foo
{
  unbacked property string str
  getter
  {
    stdout::println("interface getter");
    return "hi";
  }
  setter(value)
  {
    stdout::println("interface setter: " + value);
  }
  constructor(value)
  {
    stdout::println("interface constructor: " + value);
  };
  void doStuff()
  {
    stdout::println(str);
  }
  void test()
  {
    stdout::println("Foo::test()");
  }
}

class Super
{
  property string str
  constructor(value)
  {
    stdout::println("constructor: " + value);
    str = value;
  }
  setter(value)
  {
    stdout::println("1 str: " + str + " value: " + value);
    string old = str;
    stdout::println("2 str: " + str + " old: " + old + " value: " + value);
    str = value;
    stdout::println("3 str: " + str + " old: " + old + " value: " + value);
    if !value.equals(old)
    {
      this.str = value;
    }
  }
  getter
  {
    stdout::println("getter: " + str);
    return str;
  };

  {
    stdout::println("foo.bar.Super initialiser");
  }

  void test()
  {
    stdout::println("Super::test()");
  }
  void test(uint x)
  {
    stdout::println("Super::test(" + x + ")");
  }

  constructor(string s)
  {
    str = s;
    stdout::println("foo.bar.Super constructor");
    super();
    stdout::println("foo.bar.Super constructor, after super() call");
  }
}

class Test extends Super implements Foo
{
  static
  {
    stdout::println(x);
  }
  static final property uint x = 2
  constructor(value)
  {
    stdout::println("x-constructor: " + value);
    x = value;
  }
  getter
  {
    return x;
  };

  {
    if (false)
    {
      throw new Error("from initialiser");
    }
  }

  void test()
  {
    stdout::println("Test::test()");
    { -> void} f = cast<{-> void}> super.test;
    f();
  }

  selfish constructor(string a) throws Error
  {
    super("foo");
    str = "init";
    stdout::println("Test(uint): " + a);
  }

  static uint main([]string args) throws Error
  {
    Test test = new Test("test");
    stdout::println(x);
    stdout::println(test.str);
    test.doStuff();
    test.test();
    return 0;
  }
}
