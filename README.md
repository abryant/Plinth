## Plinth

This project aims to implement a new programming language called "Plinth".

There is not yet much documentation on the syntax and semantics of the language, but more will be made available when more of the core language features have been implemented.

### Instructions

You will need: Java (JDK) >= 1.5, LLVM 3.2, and optionally GCC (for compilation to native code)

To run the compiler, you will need an LLVM shared library to be installed. The version it requires has not yet been released, so it must be built from the LLVM source repository (revision 164247 or later). Specifically, it looks for "LLVM-3.2svn" (`libLLVM-3.2svn.so` on Linux). Since we need the shared library version of LLVM here, you need to configure your LLVM build with `--enable-shared`.

To compile the compiler:

    src$ javac -d ../bin -cp ../lib/jna.jar:. **/*.java

To build the plinth runtime (the runtime is architecture independent, but platform dependent; a pre-built runtime for linux exists at `plinth-lib/core-linux.pbc`):

    plinth-lib$ clang -emit-llvm -o core/c/io.bc -c core/c/io.c
    plinth-lib$ llvm-link -o core.pbc core/c/io.bc core/*.ll

To run (after making sure your `llvm/lib` folder is in your `LD_LIBRARY_PATH`):

    bin$ java -cp ../lib/jna.jar:. eu.bryants.anthony.plinth.compiler.Compiler -o binary.pbc --main-type foo.bar.Test -l ../plinth-lib/core.pbc ../Test.pth ../plinth-src/string.pth ../plinth-src/stdin.pth ../plinth-src/stdout.pth

The files in plinth-src, including `string.pth` and `stdout.pth`, should be compiled along with your own source files to allow you to use strings and the standard I/O streams.

The file `plinth-lib/core.pbc` is the compiled version of `plinth-lib/core/*.ll`, and includes low level functions that must be linked to your program in order to use `stdin`, `stdout`, and `stderr`.

To generate an executable from the linked bitcode:

    llc binary.pbc -o binary.s
    gcc binary.s -o binary

To run your program and check the result:

    ./binary
    echo $?

Alternatively, you can run the LLVM bitcode generated by the compiler directly via the LLVM interpreter:

    lli binary.pbc
    echo $?

